\ Information                                                                                                                   NEWAPP is a skeletal program that allows users to quickly       develop an MS-DOS application. It provides often needed         tasks including error handling, command-line parsing, file      operations, buffered I/O, help screen, number and string        functions.                                                                                                                      NEWAPP comprises two parts:                                                                                                       NEWAPP.SCR   skeletal main program                              DOSLIB.SCR   function support library                                                                                                                                                                                                                                                                                         \ Load - main screen                                            empty  forth definitions  decimal                               application  warning on                                                                                                         : TITLE ." NEWAPP version 0.0  2013-07-17" cr ;                                                                                 cr .( Compiling: )  title  2 load                                                                                               cr .( Save to disk? )  y/n                                      [if]                                                            \  pad reserve @ + 256 + limit s0 @ - + set-limit                 turnkey program  NEWAPP                                       [then]                                                                                                                                                                                                                                                          \ Load - defaults                                               variable RESERVE  0 reserve !       \ reserved memory tally     defer ?BREAK  ' noop is ?break      \ break check off           defer SET-IO  ' noop is set-io      \ default console mode      defer ERRFIX  ' noop is errfix      \ reset on-error handler    defer ONSTART ' noop is onstart     \ startup initialization                                                                    blk @ 1+ #screens 1- thru       \ load electives & application                                                                   ' (?break) is ?break           \ enable user break             \ ' dos-io is set-io             \ enable console redirection   \ ' deloutfile +is errfix        \ delete outfile on error      \ wrtchk off                     \ disable overwrite check                                                                                                                                                                                                      \ Load - electives                                               1 fload DOSLIB     \ load DOSLIB library                                                                                        _Errors            \ error handler                              _Inout1            \ number output                              _Inout2            \ string & number input                      _String1           \ basic strings                              _String2           \ extra strings                              _Parsing           \ command-line parsing                       _Fileprims         \ file primitives                            _Files             \ default files                              _Bufinfile         \ buffered input file                        _Bufoutfile        \ buffered output file                                                                                                                                                                                                                      \ Help screen - HELP                                            : HELP ( -- )  ( dos-io)  cr cr title                             cr ." Use:  NEWAPP [options] file[.TXT] [file[.DOC]]" cr        cr ." -A    set A option"                                       cr ." -B    set B option"                                       cr ." -Cn   set C option using numeric argument (1-10)"         cr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \ Help screen - HELP                                              cr ." default: list program defaults here"                      cr                                                              cr ." Insert a brief description of program here."              cr ." HELP should be invoked when a program cannot"             cr ." proceed due to fatal user error."                         set-io  error1 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ Variables                                                     variable A-VAR                  \                               variable B-VAR                  \                               1 value  C-VAL                  \                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ (SETOPTION)                                                   \ Set options                                                   : (SETOPTION) ( a u char -- a u )                                 upcase case                                                       [char] A  of  A-VAR on   endof                                  [char] B  of  B-VAR off  endof                                  [char] C  of  1 10 /numrange to C-VAL  endof                    badoption                                                     endcase ;                                                                                                                     ' (setoption) is setoption                                                                                                                                                                                                                                                                                                                                                                      \ (PARSEFILENAME)                                               \ Parse filenames                                               : (PARSEFILENAME) ( -- )                                          argv 0= if  help  then                                          s" TXT" +ext  infile setname                                    argv 0= if  infile filename  -path -ext  then                   s" DOC" +ext  outfile setname ;                                                                                               ' (parsefilename) is parsefilename                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ (RUN)                                                         \ Run application                                               : (RUN) ( -- )                                                    cr ." infile:  "  infile .file   r/o openinfile                 cr ." outfile: "  outfile .file  r/w makeoutfile                cr ( perform the application tasks )                            begin readchar while writechar repeat  \ a sample application   closefiles                                                      ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ DEFAULTS                                                      \ Set application defaults                                      : DEFAULTS ( -- )                                                 ;                                                                                                                             defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ RUN PROGRAM                                                   \ Run application with error handling                           : RUN ( -- )                                                      ['] (run) catch ?dup if  >r errfix r> throw  then ;                                                                           \ Main                                                          : PROGRAM ( -- )                                                  onstart               \ startup initialization                  set-io                \ set console mode                        defaults              \ set defaults                            cr title              \ show application name                   parsecmd              \ process command-line                    run                   \ run application                         cr ." done"           \ show success                            ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             