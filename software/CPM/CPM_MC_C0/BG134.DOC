  BackGrounder ii -- Additional Documentation for version 1.34


Release:	version 1.34 
From:		Plu*Perfect Systems
		410 23rd St.			<< -- Note new address
		Santa Monica CA 90402
Date:		October 28, 1989

Previous release: version: 1.13	


		       -- READ THIS !! --

You MUST replace earlier versions of BG.REL, LOADBG.COM and
SETBG.COM with the new files!  The new ones incompatible with
earlier versions.

Other new files are:

  BGHIST07.OCP	Z-System command history shell and error-handler
		Also included CP (file copy) command. 
  BGHIST.HLP	help file for BGHIST
  K8384FNK.DRV	functionkey driver for Kaypros
  ON!TVI.DRV	screendriver for Oneac ON! 

BackGrounder ii has been significantly enhanced.  This file
contains notes on the most important changes.  You may wish to
print it out and insert into your user's manual, or otherwise
mark points of change in the manual.


		      -- Capsule Summary --

The BGii command processor is functionally almost identical to
ZCPR version 3.4.  Users running a "Z34" system can run commands
under BGii just as they do under their Z System.

BGii loads (with no patching required) into the following systems:
	CP/M 2.2, ZSDOS 1.0, ZDDOS 1.0, ZRDOS 1.7

CALC now shows values in both decimal and hex, and a number can
be entered in either radix without changing mode.

SETBG allows you to rename the BG commands.

In a Z System, the BG OFF command now restores the RCP and IOP
addresses and sizes in the Z3 environment.

ECHO allows display of lower-case characters.

Executable (.COM) files that do not use key definitions can now
be loaded slightly faster, by setting the "noLoad" attribute bit
(f1) of the filename.

The BGii command processor will only access the specific drives
that are available on your system.  On a Z System these drives
are specified in the Z3 environment.  On other systems use SETBG
to specify the available drives.

The command-search hierarchy has been changed so that OCP and RCP
commands can override built-in BGii commands of the same name.


		       --  version 1.34 --

ERA command will skip read-only and system files now.

When used in the background with ZSDOS and BDOS error trapping
enabled, HELP, TYPE and other commands that search a file path
will now be able to find a file in a user number that is not the
default user number.

The screendriver is now correctly called with the upper/lower task
flag byte.

	       -- More Details on version 1.30 --

   BG OFF will now restore the RCP and IOP addresses and sizes in
the z3 environment.  If the RCP space was used by BGii, the first
byte of the first rcp command (rcp+6) is set to 0.  To restore
the CONTENTS of the rcp you should run JetLDR with the RCP's
name, probably as the first command after BG OFF.  This can be
handled by an alias, say "BGOFF."


For upper and lower foreground tasks, BGii now copies the command
processor's current drive and current user into the message
buffer in a Z-System.  These are read-only bytes -- if an
application changes them the actual logged DU: remains the same.
The BACKGROUND current DU: is not recorded in the message buffer;
as the FCP and RCP are disabled in background, this should have
no material effect.  A background PEEK at those bytes, after a
background DU: command would show that they are not changed in
background. 


ECHO supports:

	%>	shift to lower case
	%<	shift to upper case
	%%	print a '%'

If the noLoad bit (f1) is set in a COM file, loading is a bit faster --
the check for an attached ".BG" key definitions file is skipped.  If
you set this attribute bit for non-interactive programs and those
for which you don't expect to use a redraw string or key macros you
will get highest performance.

The "BG" command now reports commands in search-order hierarchy:
	OCP, if any
	RCP, if any
	CPR

LOADBG now gets BDOS address from the extended environment, if
one.  This should enable us to use BGii with non-standard DOS
locations and lengths, with a suitable BDOS id patch and a bdos
that conforms to BGii's patch and re-entry requirements. 
Obviously something not yet tested, but a nice hook for an
eventual banked BDOS.  


The command search hierarchy (p. 123) is:
    1. flow-control package (in a Z-system)
    2. overlay-command processor commands
    3. resident-command-package (in a Z-System)
    4. BGii command processor commands
    5. drive-user (DU:) or named-directory (DIR:) commands
    6. transient commands (COM files)
    7. extended command processor (CMDRUN.COM)

The extended command processor can be invoked immediately by
preceeding a command with:
     a SPACE
     a '/'

A transient command (COM file) can be invoked immediately by
preceeding the command with:
     '.', or
     ':', for a file in the path
     DU: prefix, for a file in the specified DU: directory, then the path


Here's an example, assuming command-run is set:

	A0>WS		will search the path for WS.COM
	A0> WS		will load CMDRUN (or other-named external command
			processor and pass the command line "WS" to it.

Another example:

	A0>PEEK		peeks at memory with BGii's built-in command
	A0> PEEK	invokes the external command processor (e.g. to
			process the alias "PEEK")
	A0>:PEEK	searches the path for PEEK.COM; if not found,
			invokes the external command processor
	A0:.PEEK	does the same as ":PEEK"
	A0>B12:PEEK	searches B12:, then the path, then invokes
			the external command processor


When run on a Z-System, BGii:

- Loads both "type-4" and "type-3" environment files that run in high memory.
  (p. 121)

- Reports error codes to the Z-System message buffer for processing by an
  external error handler.

- BGii automatically detects a Z-System tool (one with "Z3ENV"
  at offset 3 in the file) and installs the Z-System external
  environment address.  This is now also done for the GET command.
 
- BGii is not identifiable as a ZCPR v 3.3 or v 3.4 command processor,
  it does not support their "reparse" and "scan" entry points.


Functionkey drivers and screendrivers that depend on addresses in the
host computer's original BIOS (the "CBIOS") will now run under the
NZ-COM system.  To do so, they must be modified to reference those
addresses indirectly, through a pointer to the CBIOS warmboot entry.
The following data structure must appear somewhere in the driver:

	db	'CBIOS'		; signature for LOADBG
cbios:	dw	0000		; pointer to cbios warmboot entry


DosDisk should normally not be run with BGii.  To use DosDisk,
remove BGii with the command "BG OFF", load DosDisk and use the
MS-DOS disk, then remove DosDisk and re-install BGii.


The following z3 message buffer variables are not maintained
in the z3 environment area:

	subflag	; submit-running


The xsubflag is not supported.  XSUB will not run with BGii
anyway; I believe it crashes the system, probably because of
failure to test for the presence of an rsx.


		  -- Notes from version 1.13 --

		    NEW AND CHANGED FEATURES

1.  BGii loads a bit faster than versions 1.0x.

3.  In a ZCPR3 system with a multiple-command line, LOADBG executes any
    commands remaining on the command line.  For example, if you load BGii
    by typing the ZCPR3 command line:

	LOADBG;DIR A0:*.COM
    
    LOADBG will load BGii, run any pre-configured auto-command line,
    and then run the DIR command.

5.  Information messages are now displayed by the "//" parameter
    on a command line of most BGii utilities  -- PUTBG, SPOOLER, Q
    LOADBG, SECURE.

6.  PUTBG and LOADBG -- now support oddball disk drivers that use only 8
    of the 16 single-byte group numbers in each directory entry
    (e.g. certain SWP co-power ramdisks and TVI computers).


			 BUGS CORRECTED:

1. Submit files now execute correctly when using named-directories
or a TIME prompt.

2. The background drive/user prompt is now correct when first
SUSPENDing from a program.

3. The REName command now reports an error if the file cannot be found.

4. The BG command now omits displaying RCP commands in Background
CP/M; (RCP commands can be run only from Foreground CP/M).



	     ADDITIONS AND CHANGES TO USER'S MANUAL:

1. p. 5. BackGrounder ii requires that DateStamper, if used, be loaded
   "above the bios".  See the DateStamper manual for instructions.

2. p. 124.  In the final line in the "State Determination"
   section, change "1602h" to "15A8h".

3. The CUT command, in most screendrivers, has a Cancel command.  Type
   Control-C to cancel the cutting operation.  Some screendrivers allow
   the cursor to be moved up and to the left after the first mark is set;
   others, for lack of space, do not.

4. p. 54, p. 118.  No patches are required to add a redraw-screen
   command to the NewWord editor.  Its built-in command is ESC.

5. pp 105 ff.  Additional programmer's notes for coding a screendriver
   are found in BGSCREEN.DOC.

6. DIR Command (p. 67, 89)

   When displaying filesizes, DIR stutters a bit for large files. 
   This is normal, and unavoidable.  The command must calculate the
   size of a multi-extent file by reading the directory several
   times;  there is not enough memory available to store the directory
   in memory.

   You can eliminate the jerkiness, and the filesizes,
   by making "no filesize" the default configuration with SETBG, or
   by using the "/F" flag, e.g. DIR *.DOC /F.

7. CUT Command (pp. 36,66).  When marking a region to be cut, typing
   a Control-C will cancel the command.


			   OTHER NOTES


A number of users have requested additional features and also
pointed out a few anomolies.  We're grateful for the suggestions,
have given consideration to each, and have been able to make a
number of enhancements.  Unfortunately, BGii does have limits,
and several worthwhile ideas simply haven't been possible.

			    Internals

BGii corresponds most closely to these ZCPR34 options:

fullget		NO
duenv		YES
aduenv		YES
drvprefix	YES
scancur		NO
accptdu		YES	controlled by duok
accptdir	YES
dufirst		YES
pwcheck		YES
wpass		YES
skippath	YES
fastecp		YES
altspace	YES	char = '/'
altcolon	YES	char = '.'
rootonly	controlled by SETBG parameter
badduecp	YES
badcmdecp	YES

See the SETBG menus for user-settable variations.
the filesizes,
   by making "no filesi